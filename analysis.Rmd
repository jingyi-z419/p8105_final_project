---
title: "Analysis"
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
---


```{r setup, include=F}
library(tidyverse)
library(gganimate)
library(flexdashboard)
library(patchwork)
library(plotly)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))
          
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

```


### Loading and tidying the data

We filtered the data so it only contains information for NY state from 2016-2017. 

```{r message=F}
ny_local = 
  read_csv("./data/500_Cities.csv") %>% 
  janitor::clean_names() %>% 
  filter(state_abbr == "NY")
```

## Unhealthy Behaviors plot

```{r ub_overall_boxplot, warning=F, message=F}
ub_overall_plot =
  ny_local %>% 
  select(category, measure_id, data_value) %>% 
  filter(category == "Unhealthy Behaviors") %>% 
  ggplot(aes(x = measure_id, y = data_value, color = measure_id)) +
  geom_boxplot() +
  labs(
    x = "Unhealthy Behavior",
    y = "Prevalence (%)"
  ) +
  scale_y_continuous(limits = c(0, 100))

ggplotly(ub_overall_plot)
```



```{r current_smoking, warning=F, message=F}
mental_health_value =
  ny_local %>%
  select(unique_id, data_value, measure_id, population_count) %>% 
  filter(measure_id == "MHLTH") %>% 
  mutate(value_m = data_value) %>% 
  select(unique_id, value_m, population_count)

current_smoking_value =
  ny_local %>%
  select(unique_id, data_value, measure_id, population_count) %>% 
  filter(measure_id == "CSMOKING") %>% 
  mutate(value_c = data_value) %>% 
  select(unique_id, value_c, population_count)

mental_smoking =
  left_join(mental_health_value, current_smoking_value)


current_smoking_plot =
  mental_smoking %>% 
  ggplot(aes(x = value_m, y = value_c, size = population_count)) +
  geom_point(alpha = 0.5, color = "steel blue") +
  labs(
    x = "Mental Health Prevalence (%)",
    y = "Unhealthy Behavior Prevalence (%)",
    title = "Current Smoking"
  ) +
  scale_y_continuous(limits = c(0, 100)) 

ggplotly(current_smoking_plot)
```


```{r binge_drinking, warning=F, message=F}
binge_drinking_value =
  ny_local %>% 
  select(unique_id, data_value, measure_id) %>% 
  filter(measure_id == "BINGE") %>% 
  mutate(value_b = data_value) %>% 
  select(unique_id, value_b)

binge_drinking =
  left_join(mental_health_value, binge_drinking_value)

binge_drinking_plot =
  binge_drinking %>% 
  ggplot(aes(x = value_m, y = value_b, size = population_count)) +
  geom_point(alpha = 0.5, color = "darkorchid4") +
  labs(
    x = "Mental Health Prevalence (%)",
    y = "Unhealthy Behavior Prevalence (%)",
    title = "Binge Drinking"
  ) +
  scale_y_continuous(limits = c(0, 100))

ggplotly(binge_drinking_plot)
```

```{r physical_inactivity, warning=F, message=F}
physical_inactivity_value =
  ny_local %>% 
  select(unique_id, data_value, measure_id) %>% 
  filter(measure_id == "LPA") %>% 
  mutate(value_p = data_value) %>% 
  select(unique_id, value_p)

physical_inactivity =
  left_join(mental_health_value, physical_inactivity_value)

physical_inactivity_plot =
  physical_inactivity %>% 
  ggplot(aes(x = value_m, y = value_p, size = population_count)) +
  geom_point(alpha = 0.5, color = "darkcyan") +
  labs(
    x = "Mental Health Prevalence (%)",
    y = "Unhealthy Behavior Prevalence (%)",
    title = "Physical Inactivity"
  ) +
  scale_y_continuous(limits = c(0, 100))

ggplotly(physical_inactivity_plot)
```

```{r obesity, warning=F, message=F}
obesity_value =
  ny_local %>% 
  select(unique_id, data_value, measure_id) %>% 
  filter(measure_id == "OBESITY") %>% 
  mutate(value_o = data_value) %>% 
  select(unique_id, value_o)

obesity =
  left_join(mental_health_value, obesity_value)

obesity_plot =
  obesity %>% 
  ggplot(aes(x = value_m, y = value_o, size = population_count)) +
  geom_point(alpha = 0.5, color = "chartreuse4") +
  labs(
    x = "Mental Health Prevalence (%)",
    y = "Unhealthy Behavior Prevalence (%)",
    title = "Obesity"
  ) +
  scale_y_continuous(limits = c(0, 100))

ggplotly(obesity_plot)
```


```{r sleep, warning=F, message=F}
sleep_value =
  ny_local %>% 
  select(unique_id, data_value, measure_id) %>% 
  filter(measure_id == "SLEEP") %>% 
  mutate(value_s = data_value) %>% 
  select(unique_id, value_s)

sleep =
  left_join(mental_health_value, sleep_value)

sleep_plot =
  sleep %>% 
  ggplot(aes(x = value_m, y = value_s, size = population_count)) +
  geom_point(alpha = 0.5, color = "darkgoldenrod2") +
  labs(
    x = "Mental Health Prevalence (%)",
    y = "Unhealthy Behavior Prevalence (%)",
    title = "Sleep < 7 hours"
  ) +
  scale_y_continuous(limits = c(0, 100))

ggplotly(sleep_plot)
```


## Prevention plots

```{r}
prevention = 
  ny_local %>% 
  filter(category == "Prevention") %>% 
  group_by(measure_id) %>% 
  ggplot(aes(x = measure_id, y = data_value)) +
  geom_boxplot(aes(size = population_count, colour = as.factor(year) ),
             alpha = 0.5) +
  labs(title = "The Prevalence of Prevention Measure",
       x = 'Prevention Measure', 
       y = 'Prevalence (%)') +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) 

prevention
```




```{r}
mental_health_df = 
  ny_local %>% 
  select(unique_id, data_value, measure_id) %>% 
  filter(measure_id == "MHLTH") %>% 
  mutate(value_mental = data_value) %>% 
  select(unique_id, value_mental)


checkup_df =
  ny_local %>% 
  select(unique_id, data_value, measure_id) %>% 
  filter(measure_id == "CHECKUP") %>% 
  mutate(value_checkup = data_value) %>% 
  select(unique_id, value_checkup)


mental_checkup = 
  left_join(mental_health_df, checkup_df)

mental_checkup_plot = 
  mental_checkup %>% 
  ggplot(aes(x = value_mental, y = value_checkup)) +
  geom_point(color = "red") +
  labs(title = "Current Annual Checkup",
       x = 'Mental Health Prevalence (%)', 
       y = 'Unhealty Behavior') +
  scale_y_continuous(limits = c(0, 100))

mental_checkup_plot
```

```{r}
insurance_df =
  ny_local %>% 
  select(unique_id, data_value, measure_id) %>% 
  filter(measure_id == "ACCESS2") %>% 
  mutate(value_insurance = data_value) %>% 
  select(unique_id, value_insurance)


mental_insurance = 
  left_join(mental_health_df, insurance_df)

mental_insurance_plot = 
  mental_insurance %>% 
  ggplot(aes(x = value_mental, y = value_insurance)) +
  geom_point(color = "yellow") +
  labs(title = "Current Lack of Insurance",
       x = 'Mental Health Prevalence (%)', 
       y = 'Unhealty Behavior') +
  scale_y_continuous(limits = c(0, 100))

mental_insurance_plot
```

